import{u as F,r as o,U as P,j as t,s as i,E as Y,S as k,T as q,C as z,a as G,l as J,w as r}from"./index-2519772c.js";const O="_comment_item_1cfgw_2",a={comment_item:O,"fade-enter":"_fade-enter_1cfgw_6","fade-enter-active":"_fade-enter-active_1cfgw_11","fade-exit":"_fade-exit_1cfgw_16","fade-exit-active":"_fade-exit-active_1cfgw_21"},j="https://mern-polling.onrender.com/api/v1",T=3,Q=({pollId:c})=>{const v=F();console.log(v);const[w,C]=o.useState(null),[h,l]=o.useState([]),[u,H]=o.useState(!0),[f,b]=o.useState(1),[M,m]=o.useState(!0),[I,L]=o.useState(!0),[x,g]=o.useState(""),{userInfo:E}=o.useContext(P),d=o.useRef(null),_=()=>{const e=d.current;e&&e.scrollTop+e.clientHeight>=e.scrollHeight&&b(s=>s+1),console.log({container:e,page:f})};o.useEffect(()=>{const e=d.current;if(console.log(e),e)return e.addEventListener("scroll",_),()=>{e.removeEventListener("scroll",_)}},[d]);const N=e=>{l(s=>s.filter(n=>n._id!==e))},U=async e=>{if(e.preventDefault(),x.length<3)return r.warning("The comment should contain 3 characters");m(!0);try{const s=await fetch(`${j}/comment/postComment/${c}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment:x}),credentials:"include"}),n=await s.json();if(console.log(n),s.ok){const{newComment:S,updatedComment:p}=n;S?l(y=>[S,...y]):p&&(N(p._id),l(y=>[p,...y])),g(""),r(n.message,{type:"info"})}else r(n.message,{type:"warning"})}catch(s){console.log("Error while posting your comment",s),r.error("Error posting comment")}finally{m(!1)}},$=async()=>{m(!0),C(null);try{const e=await fetch(`${j}/comment/getComments/${c}?page=${f}&limit=${T}`),s=await e.json();if(e.ok&&s.success)l(n=>[...new Set([...n,...s.comments])]),s.comments.length<T&&H(!1);else throw new Error((s==null?void 0:s.message)||"Server Error")}catch(e){console.error("Error fetching comment count:",e),C(e.message)}finally{m(!1),L(!1)}},B=e=>{g(e),r("post the new comment it will update your previous comment",{position:"top-center"});const s=document.getElementById(`commentInput${c}`);s&&s.focus()},D=async e=>{try{const s=await fetch(`${j}/comment/deleteComment/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"}),n=await s.json();s.ok?(N(e),r(n.message,{type:"info"})):r(n.message,{type:"warning"})}catch(s){console.log("Error while posting your comment",s),r("Error deleting comment",{type:"error"})}},R={resize:"none",overflowY:"hidden",minHeight:"50px"};o.useEffect(()=>{u&&$()},[f,u]);const A=e=>{g(e.target.value);const s=event.target;s.style.height="auto",s.style.height=`${s.scrollHeight}px`;const n=parseInt(window.getComputedStyle(s).lineHeight)*4;s.scrollHeight>n?(s.style.height=`${n}px`,s.style.overflowY="auto"):s.style.overflowY="hidden"};return t.jsxs(t.Fragment,{children:[t.jsx("form",{className:`flex ${i.heading5}`,onSubmit:U,children:t.jsxs("div",{className:"relative w-full overflow-hidden rounded-xl",children:[t.jsx("textarea",{id:`commentInput${c}`,name:"comment",value:x,onChange:A,className:"w-full border-2 border-slate-400 pl-3 sm:pl-5 py-2 outline-none focus:border-slate-600 rounded-xl pr-12 sm:pr-16",placeholder:"Enter your comment here",autoComplete:"off",style:R,required:!0}),t.jsx("button",{type:"submit",className:`absolute bottom-4 right-3 bg-slate-300 text-black hover:bg-sky-400 hover:text-white rounded-md px-3 py-1.5 cursor-pointer duration-500 transition-colors ${i.smHeading} ${i.flexCenter}`,title:"comment",children:t.jsx("ion-icon",{name:"send"})})]})}),w?t.jsx(Y,{heading:"Error Fetching Comments",message:w,action:$}):I?t.jsx("div",{className:" w-full flex justify-center items-center",children:t.jsx(k,{})}):h.length>0?t.jsxs("div",{className:`my-3 py-3 ${v.pathname.includes("/poll/posts/")?"":"max-h-96 border border-slate-800 rounded-lg px-5"} overflow-auto`,ref:d,children:[t.jsxs("div",{className:`flex justify-between mb-4 ${i.heading5}`,children:[t.jsx("p",{children:"Comments"})," ",t.jsx("p",{className:"cursor-pointer",children:"Most Relevent"})]}),t.jsx(q,{children:h.map((e,s)=>t.jsx(z,{timeout:500,classNames:{enter:a["fade-enter"],enterActive:a["fade-enter-active"],exit:a["fade-exit"],exitActive:a["fade-exit-active"]},children:t.jsxs("div",{className:`rounded-md bg-slate-100 p-1 sm:p-3 ${h.length-1===s?"":"mb-5"} ${a.comment_item}`,children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-1",children:t.jsx(G,{userId:e.commentedBy})}),E&&E._id===e.commentedBy&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:" hover:text-blue-600",title:"Edit Comment",onClick:()=>B(e.comment),children:t.jsx("ion-icon",{name:"create-outline"})}),t.jsx("button",{className:"md:ml-3 lg:ml-5 ml-1 hover:text-red-500",title:"Delete Comment",onClick:()=>D(e._id),children:t.jsx("ion-icon",{name:"trash-outline"})})]})]}),t.jsx("h1",{className:`${i.heading5} mt-1 px-2`,children:e.comment})]})},e._id))}),t.jsx("div",{className:"flex justify-center items-center",children:M&&t.jsx(k,{})}),t.jsx("div",{className:`mt-8 flex justify-center items-center font-bold ${i.heading6}`,children:u?t.jsx("div",{className:"cursor-pointer duration-500 hover:bg-sky-300 transition-colors rounded-md  px-2 md:px-3 py-1",onClick:()=>b(e=>e+1),children:"loadMore"}):t.jsx("div",{className:"",children:"End Comments"})})]}):t.jsxs("div",{className:"flex flex-col justify-center items-center my-3 py-3 px-5",children:[t.jsx("img",{src:J,alt:"comment",className:"lg:h-44 md:h-40 sm:h-36 h-28"}),t.jsx("h1",{className:`font-semibold ${i.heading5}`,children:"Be the first to comment"})]})]})};export{Q as default};
