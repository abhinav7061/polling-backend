import{r as c,j as e,a as S,u as k,U as C}from"./index-4dcbfe16.js";import{w as x}from"./index-69a0fb70.js";import{u as T,v as $}from"./index-8eda0750.js";import{l as O}from"./lock-18c19254.js";import{s as v}from"./styles-e7ca6728.js";import{d as I}from"./debounce-13b53e9a.js";import{C as E}from"./CircleLoader-a3da6b15.js";const P=({length:m=6,onChange:h})=>{const[l,d]=c.useState(Array(m).fill("")),f=(n,t)=>{const s=[...l];if(n!==""&&s.slice(0,t).some(i=>i==="")){for(let i=0;i<=t;i++)if(s[i]===""){s[i]=n;break}}else s[t]=n,n!==""&&t<m-1&&document.getElementById(`otp-input-${t+1}`).focus();d(s),h(s.join(""))},y=(n,t)=>{n.key==="Backspace"?l[t]!==""?f("",t):t>0&&(document.getElementById(`otp-input-${t-1}`).focus(),f("",t-1)):n.key==="ArrowLeft"&&t>0?document.getElementById(`otp-input-${t-1}`).focus():n.key==="ArrowRight"&&t<m-1&&document.getElementById(`otp-input-${t+1}`).focus()};return e.jsx("div",{className:"flex space-x-2",children:l.map((n,t)=>e.jsx("input",{id:`otp-input-${t}`,type:"text",maxLength:"1",value:n,onChange:s=>f(s.target.value,t),onKeyDown:s=>y(s,t),className:"w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 text-center text-lg font-medium border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-400"},t))})},N="http://localhost:5000/api/v1",F=({email:m,className:h})=>{const[l,d]=c.useState(!1),[f,y]=c.useState(!0),[n,t]=c.useState(null),[s,i]=c.useState(120),u=async()=>{d(!0);try{const o=await(await fetch(`${N}/user/resend-verification-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:m})})).json();o.success?(i(o.waitFor),x.success("New Otp has been sent")):x.error(o.message||"Failed to send OTP")}catch(r){console.error("Error:",r),x.error("An error occurred while sending OTP")}finally{d(!1)}};c.useEffect(()=>{let r;return s>0&&(r=setInterval(()=>{i(o=>o-1)},1e3)),()=>clearInterval(r)},[s]);const p=c.useCallback(async r=>{y(!0),t(null);try{const a=await(await fetch(`${N}/user/resend-verification-otp-time-left`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r})})).json();if(a.success)i(a.waitFor>0?a.waitFor:0);else throw new Error(a.message||"error fetching")}catch(o){console.error("Error:",o),t(o.message),x.error(o.message)}finally{y(!1)}},[]),g=c.useCallback(I(r=>{r&&p(r)},500),[p]);c.useEffect(()=>(g(m),()=>g.cancel()),[m,g]);const b=r=>{const o=Math.floor(r/60),a=r%60;return o>=1?`${o} min ${a}s`:`${a}s`};return e.jsx(e.Fragment,{children:m&&!n&&!f&&e.jsx("button",{type:"button",className:`font-poppins flex justify-center items-center gap-2 font-bold text-primary bg-blue-gradient rounded-md outline-none p-2 md:px-4 w-full ${l||s>0?"cursor-not-allowed":""} ${h}`,disabled:l||s>0,onClick:u,children:l?e.jsx(E,{title:"Cool Down..."}):s>0?e.jsxs("span",{className:"text-gray-600",children:["Resend OTP in ",b(s)]}):"Resend OTP"})})},R="http://localhost:5000/api/v1",K=()=>{var r,o;const[m,h]=c.useState(!1),l=S(),[d,f]=c.useState(!((r=l==null?void 0:l.state)!=null&&r.email)),y=k(),{setUserInfo:n}=c.useContext(C),t={email:((o=l==null?void 0:l.state)==null?void 0:o.email)||"",otp:""},s=async a=>{h(!0);try{const w=await fetch(`${R}/user/verify-account`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"}),j=await w.json();w.ok?(x.success("Account verified successfully"),n(j.user),y("/poll")):x.error(j.message||"Failed to verify account")}catch(w){console.error("Error:",w),x.error("An error occurred while verifying the account")}finally{h(!1)}},{values:i,errors:u,touched:p,handleSubmit:g,setFieldValue:b}=T({initialValues:t,validationSchema:$,onSubmit:s});return c.useEffect(()=>{if(d){const a=document.getElementById("email");a&&a.focus()}},[d]),e.jsxs("div",{className:"flex md:flex-row flex-col-reverse border bg-white border-sky-400 mx-2 my-4 md:m-20 rounded-2xl overflow-hidden",children:[e.jsx("div",{className:`md:w-3/5 ${v.flexStart} flex-col lg:p-16 sm:p-8 p-6`,children:e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsx("div",{className:"mb-5 md:mb-8 xl:mb-14 p-5 md:p-8 bg-yellow-100 rounded-lg border border-yellow-400 text-slate-700 text-sm leading-6 max-w-sm",children:e.jsx("p",{children:"Enter the OTP sent to your e-mail address, and we'll verify your e-mail allowing you to use this platform."})}),e.jsxs("form",{onSubmit:g,className:"w-full max-w-md",children:[d&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{htmlFor:"email",className:"text-sm font-bold ",children:["Email address ",e.jsx("sup",{className:"text-red-600 text-xs",children:"*"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",placeholder:"Enter registered email",className:`rounded-md border-2 focus:shadow-md w-full py-1 px-3 mt-1 outline-none ${u.email&&p.email?"border-red-500 focus:border-red-400":"border-sky-500 focus:border-sky-300"}`,"aria-invalid":u.email&&p.email?"true":"false","aria-describedby":"email-error",value:i.email,onChange:a=>b("email",a.target.value)}),u.email&&p.email&&e.jsx("p",{id:"email-error",className:"text-red-600 text-[12px] mt-1",children:u.email})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center mb-6",children:[e.jsx(P,{onChange:a=>b("otp",a)}),u.otp&&p.otp&&e.jsx("p",{id:"email-error",className:"text-red-600 text-[12px] mt-[3px]",children:u.otp})]}),e.jsxs("div",{className:"my-6 flex gap-5 text-sm flex-col",children:[e.jsx("button",{type:"submit",className:`font-poppins flex justify-center items-center gap-2 font-bold text-primary bg-blue-gradient rounded-md outline-none  p-2 md:px-4 w-full ${m?"opacity-75 cursor-not-allowed":""}`,disabled:m,children:m?e.jsx(E,{title:"Verifying..."}):"Verify Email"}),u.email?null:e.jsx(F,{email:i.email})]}),e.jsx("div",{className:"text-sm font-semibold text-blue-700 flex justify-center",children:e.jsxs("span",{className:"cursor-pointer flex gap-1",onClick:()=>f(!d),children:[e.jsx("span",{className:" text-base",children:e.jsx("ion-icon",{name:"create-outline"})}),"Edit email"]})})]})]})}),e.jsx("div",{className:`md:w-2/5 flex ${v.flexCenter} relative md:mx-2 md:mt-0 mt-6 mx-10`,children:e.jsx("img",{className:"w-20 md:w-full object-contain max-h-96 max-w-sm relative z-[5]",src:O,alt:""})})]})};export{K as default};
